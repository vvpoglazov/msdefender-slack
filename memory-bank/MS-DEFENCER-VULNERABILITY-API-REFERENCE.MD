# Microsoft Defender Vulnerability Management API Reference

This document provides a quick reference for commonly used Microsoft Defender Vulnerability Management API endpoints.

**Base URL:**

The base URL depends on your geo-location. Common examples include:
*   `https://api.securitycenter.microsoft.com/api` (General)
*   `https://us.api.security.microsoft.com/api` (US)
*   `https://eu.api.security.microsoft.com/api` (Europe)
*   `https://uk.api.security.microsoft.com/api` (UK)

Refer to the official documentation for the appropriate URL for your tenant.

**Authentication:**

Authentication is typically done using OAuth 2.0 with Azure Active Directory (Azure AD). You'll need:
*   Tenant ID
*   Client ID
*   Client Secret

These credentials are used to obtain a Bearer token for the `Authorization` header.

**Permissions:**

Required permissions usually include `Vulnerability.Read.All` (for application context) or `Vulnerability.Read` (for delegated context). Check the documentation for specific endpoint requirements.

**Key Endpoints:**

1.  **List Vulnerabilities**
    *   **Method:** `GET`
    *   **Path:** `/vulnerabilities`
    *   **Description:** Retrieves a list of vulnerabilities affecting the organization. Supports OData V4 queries for filtering and pagination.
    *   **OData Support:** `$filter` (on `id`, `name`, `description`, `cvssV3`, `publishedOn`, `severity`, `updatedOn`), `$top` (max 8000), `$skip`.
    *   **Key Properties:** `id` (CVE ID), `name`, `description`, `severity` ('Low', 'Medium', 'High', 'Critical'), `cvssV3`, `exposedMachines`, `publishedOn`, `updatedOn`, `publicExploit`, `exploitVerified`.
    *   **Reference:** [https://learn.microsoft.com/en-us/defender-endpoint/api/get-all-vulnerabilities](https://learn.microsoft.com/en-us/defender-endpoint/api/get-all-vulnerabilities)
    *   **Example Response:**
        ```json
        {
            "@odata.context": "https://api.securitycenter.microsoft.com/api/$metadata#Vulnerabilities",
            "value": [
                {
                    "id": "CVE-2024-7256",
                    "name": "CVE-2024-7256",
                    "description": "Summary: Google Chrome is vulnerable to a security bypass due to insufficient data validation in Dawn. An attacker can exploit this vulnerability by tricking a user into visiting a malicious website, allowing them to bypass security restrictions. Impact: If successfully exploited, this vulnerability could allow a remote attacker to bypass security restrictions in Google Chrome. Remediation: Apply the latest patches and updates provided by the respective vendors. Generated by AI",
                    "severity": "High",
                    "cvssV3": 8,
                    "cvssVector": "CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H/E:U/RL:O/RC:C",
                    "exposedMachines": 23,
                    "publishedOn": "2024-07-30T00:00:00Z",
                    "updatedOn": "2024-07-31T00:00:00Z",
                    "firstDetected": "2024-07-31T01:55:47Z",
                    "publicExploit": false,
                    "exploitVerified": false,
                    "exploitInKit": false,
                    "exploitTypes": [],
                    "exploitUris": [],
                    "cveSupportability": "Supported",
                    "tags": [],
                    "epss": 0.632
                }
                // ... more vulnerabilities ...
            ]
        }
        ```

2.  **Get Vulnerability by ID**
    *   **Method:** `GET`
    *   **Path:** `/vulnerabilities/{cveId}`
    *   **Description:** Retrieves detailed information for a specific vulnerability using its CVE ID.
    *   **Reference:** [https://learn.microsoft.com/en-us/defender-endpoint/api/get-vulnerability-by-id](https://learn.microsoft.com/en-us/defender-endpoint/api/get-vulnerability-by-id)
    *   **Example Response (for CVE-2019-0608):**
        ```json
        {
            "@odata.context": "https://api.securitycenter.microsoft.com/api/$metadata#Vulnerabilities/$entity",
            "id": "CVE-2019-0608",
            "name": "CVE-2019-0608",
            "description": "A spoofing vulnerability exists when Microsoft Browsers does not properly parse HTTP content. An attacker who successfully exploited this vulnerability could impersonate a user request by crafting HTTP queries. The specially crafted website could either spoof content or serve as a pivot to chain an attack with other vulnerabilities in web services.To exploit the vulnerability, the user must click a specially crafted URL. In an email attack scenario, an attacker could send an email message containing the specially crafted URL to the user in an attempt to convince the user to click it.In a web-based attack scenario, an attacker could host a specially crafted website designed to appear as a legitimate website to the user. However, the attacker would have no way to force the user to visit the specially crafted website. The attacker would have to convince the user to visit the specially crafted website, typically by way of enticement in an email or instant message, and then convince the user to interact with content on the website.The update addresses the vulnerability by correcting how Microsoft Browsers parses HTTP responses.",
            "severity": "Medium",
            "cvssV3": 4.3,
            "exposedMachines": 4,
            "publishedOn": "2019-10-08T00:00:00Z",
            "updatedOn": "2019-12-16T16:20:00Z",
            "publicExploit": false,
            "exploitVerified": false,
            "exploitInKit": false,
            "exploitTypes": [],
            "exploitUris": []
        }
        ```

3.  **List Devices by Vulnerability**
    *   **Method:** `GET`
    *   **Path:** `/vulnerabilities/{cveId}/machineReferences`
    *   **Description:** Retrieves a list of devices (machines) exposed to a specific vulnerability.
    *   **Key Properties (in response value):** `id` (Device ID), `computerDnsName`, `osPlatform`, `rbacGroupName`.
    *   **Reference:** [https://learn.microsoft.com/en-us/defender-endpoint/api/get-machines-by-vulnerability](https://learn.microsoft.com/en-us/defender-endpoint/api/get-machines-by-vulnerability)
    *   **Example Response:**
        ```json
        {
            "@odata.context": "https://api.securitycenter.microsoft.com/api/$metadata#MachineReferences",
            "value": [
                {
                    "id": "235a2e6278c63fcf85bab9c370396972c58843de",
                    "computerDnsName": "h1mkn_PC",
                    "osPlatform": "Windows10", // Note: Can also be "Windows11" etc.
                    "rbacGroupName": "GroupTwo"
                },
                {
                    "id": "afb3f807d1a185ac66668f493af028385bfca184",
                    "computerDnsName": "chat_Desk ",
                    "osPlatform": "Windows11",
                    "rbacGroupName": "GroupTwo"
                }
                // ... more machine references ...
            ]
         }
        ```

**General Notes:**

*   Always refer to the official Microsoft Defender for Endpoint API documentation for the most up-to-date information, including detailed request/response schemas and specific permission requirements.
*   Use appropriate error handling for API responses (e.g., checking status codes 200, 401, 403, 404, 5xx).
*   Be mindful of API rate limits. 